<f:view xmlns="http://www.w3.org/1999/xhtml"
        xmlns:f="http://java.sun.com/jsf/core"
        xmlns:h="http://java.sun.com/jsf/html"
        xmlns:ui="http://java.sun.com/jsf/facelets"
        xmlns:eye="http://jsfcomponents.eyeline.mobi"
        >

  <ui:composition template="/templates/main.xhtml">

    <ui:define name="head">
      <link rel="STYLESHEET" type="text/css"
            href="#{facesContext.externalContext.requestContextPath}/resources/pages/clients/index.less"/>

      <script type="text/javascript" src="#{facesContext.externalContext.requestContextPath}/resources/pages/clients/index.js"></script>
    </ui:define>

    <ui:define name="scripts">
      <script type="text/javascript">
        $(function(){
          page.init();
          var blockError = "#{clientListController.blockError}";
          var unblockError = "#{clientListController.unblockError}";


          if (blockError=="true")
            ips.message.error("#{bundle['client.dialog.block.error']}");
          else if (blockError=="false")
            ips.message.info("#{bundle['client.dialog.block.done']}");


          if (unblockError=="true")
            ips.message.error("#{bundle['client.dialog.unblock.error']}");
          else if (unblockError=="false")
            ips.message.info("#{bundle['client.dialog.unblock.done']}");

        })
      </script>
    </ui:define>

    <ui:define name="content">

      <h:form enctype="multipart/form-data" id="content">
       <h:inputHidden id="userLogin" value="#{clientListController.userLogin}"/>
       <h:inputHidden id="userLoginForEdit" value="#{clientListController.userLoginForEdit}"/>


        <h:panelGroup layout="block" styleClass="border-shadow">

          <h:panelGrid columns="2" styleClass="page-header">
            <h:outputText value="#{bundle['client.list.title']}"/>
            <h:panelGroup styleClass="page-header-input">
              <h:outputLabel value="#{bundle['search.label']}"/>
              <eye:inputText id="search"
                             value="#{clientListController.search}"
                             onkeydown="return page.nameFilterKeyDown(event)"/>
            </h:panelGroup>
          </h:panelGrid>

          <eye:dataTable id="table"
                         value="#{clientListController.tableModel}"
                         var="row"
                         pageSize="50"
                         tableClass="grid">
            <f:facet name="ifEmpty">
              <h:outputText value="Нет элементов"/>
            </f:facet>
            <eye:row>
              <eye:column name="fullname" title="#{bundle['client.list.table.fullname']}"
                          sortable="true" defaultSortOrder="desc">
                <h:commandLink value="#{row.fullname}"
                               action="null"
                               onclick="return page.showSettingsDialog('#{row.fullname}',
                                                                      '#{row.company}',
                                                                      '#{row.login}',
                                                                      '#{row.email}');"/>

              </eye:column>

              <eye:column name="company" title="#{bundle['client.list.table.company']}"
                          sortable="true">
                <h:outputText value="#{row.company}"/>
              </eye:column>

              <eye:column name="login" title="#{bundle['client.list.table.login']}"
                          sortable="true">
                <h:outputText value="#{row.login}"/>
              </eye:column>

              <eye:column name="email" title="#{bundle['client.list.table.email']}"
                          sortable="true">
                <h:outputText value="#{row.email}"/>
              </eye:column>


              <eye:column name="status" title="#{bundle['client.list.table.status']}"
                          sortable="true">

                <h:outputText value="#{bundle['client.list.table.status.active']}"
                              styleClass="clientStatusActive"
                              rendered="#{row.isBlocked == false}" />

                <h:outputText value="#{bundle['client.list.table.status.blocked']}"
                              styleClass="clientStatusBlocked"
                              rendered="#{row.isBlocked == true}" />

                <h:outputText value=" ("/>
                <h:commandLink value="#{bundle['client.list.table.status.active.block']}"
                               onclick="return page.showBlockDialog('#{row.login}');"
                               rendered="#{row.isBlocked == false}">
                </h:commandLink>

                <h:commandLink value="#{bundle['client.list.table.status.blocked.unblock']}"
                               onclick="return page.showUnblockDialog('#{row.login}');"
                               rendered="#{row.isBlocked == true}">
                </h:commandLink>
                <h:outputText value=" | "/>
                <h:commandLink value="#{bundle['client.list.table.status.resetpassword']}"
                               action="null"
                               onclick="jsfc('clientPasswordResetDialog').show(); return false"/>
                <h:outputText value=")"/>
              </eye:column>

            </eye:row>
          </eye:dataTable>

          <h:panelGroup layout="block" styleClass="page-footer"/>

        </h:panelGroup>

        <h:panelGroup layout="block" style="margin-top: 15px;">
          <h:commandLink value="#{bundle['client.list.button.createclient']}"
                         styleClass="button-black"
                         onclick="jsfc('newClientDialog').show(); return false"/>
        </h:panelGroup>


        <eye:dialog id="newClientDialog" title="#{bundle['client.dialog.newclient.title']}" width="400">

          <h:panelGrid columns="2">
            <h:outputLabel value="#{bundle['client.dialog.newclient.field.fullname']}"
                           for="newClientFullName"/>
            <eye:inputText id="newClientFullName"
                           value=""/>

            <h:outputLabel value="#{bundle['client.dialog.newclient.field.company']}"
                           for="newClientCompany"/>
            <eye:inputText id="newClientCompany"
                           value=""/>

            <h:outputLabel value="#{bundle['client.dialog.newclient.field.login']}"
                           for="newClientLogin"/>
            <eye:inputText id="newClientLogin"
                           value=""/>

            <h:outputLabel value="#{bundle['client.dialog.newclient.field.email']}"
                           for="newClientEmail"/>
            <eye:inputText id="newClientEmail"
                           value=""/>


          </h:panelGrid>
          <eye:buttons>
            <eye:button>
              <h:commandLink styleClass="button-green"
                             value="#{bundle['client.dialog.newclient.button.create']}"
                             />
            </eye:button>
            <eye:button>
              <h:commandLink styleClass="button-green"
                             value="#{bundle['client.dialog.newclient.button.cancel']}"
                             onclick="jsfc('newClientDialog').hide(); ips.message.hideAll(); return false;"/>
            </eye:button>
            <eye:space/>
          </eye:buttons>

        </eye:dialog>

        <eye:dialog id="clientSettingsDialog" title="#{bundle['client.dialog.settings.title']}" width="400">

          <h:panelGrid columns="2">
            <h:outputLabel value="#{bundle['client.dialog.settings.field.fullname']}"
                           for="clientSettingsFullName"/>
            <eye:inputText id="clientSettingsFullName"
                           value="#{clientListController.userForEdit.fullName}"/>

            <h:outputLabel value="#{bundle['client.dialog.settings.field.company']}"
                           for="clientSettingsCompany"/>
            <eye:inputText id="clientSettingsCompany"
                           value="#{clientListController.userForEdit.company}"/>

            <h:outputLabel value="#{bundle['client.dialog.settings.field.login']}"
                           for="clientSettingsLogin"/>
            <eye:inputText id="clientSettingsLogin"
                           value="#{clientListController.userForEdit.login}"/>

            <h:outputLabel value="#{bundle['client.dialog.settings.field.email']}"
                           for="clientSettingsEmail"/>
            <eye:inputText id="clientSettingsEmail"
                           value="#{clientListController.userForEdit.email}"/>


          </h:panelGrid>
          <eye:buttons>
            <eye:button>
              <h:commandLink styleClass="button-green"
                             value="#{bundle['client.dialog.newclient.button.create']}"
                             action="#{clientListController.saveModifiedUser}"/>
            </eye:button>
            <eye:button>
              <h:commandLink styleClass="button-green"
                             value="#{bundle['client.dialog.newclient.button.cancel']}"
                             onclick="jsfc('clientSettingsDialog').hide(); ips.message.hideAll(); return false;"/>
            </eye:button>
            <eye:space/>
          </eye:buttons>

        </eye:dialog>

        <eye:dialog id="clientBlockDialog" title="#{bundle['client.dialog.block.title']}" width="450">
          <h:panelGroup layout="block">
            <h:outputText value="#{bundle['client.dialog.block.text']}"/>
          </h:panelGroup>
          <h:panelGroup layout="block" style="margin:10px"> </h:panelGroup>
          <eye:buttons>
            <eye:button>
              <h:commandLink styleClass="button-green"
                             value="#{bundle['client.dialog.button.confirm']}"
                             action="#{clientListController.blockUser}"/>
            </eye:button>
            <eye:button>
              <h:commandLink styleClass="button-green"
                             value="#{bundle['client.dialog.button.cancel']}"
                             onclick="jsfc('clientBlockDialog').hide(); return false;"/>
            </eye:button>
            <eye:space/>
          </eye:buttons>
        </eye:dialog>

        <eye:dialog id="clientUnblockDialog" title="#{bundle['client.dialog.unblock.title']}" width="450">
          <h:panelGroup layout="block">
            <h:outputText value="#{bundle['client.dialog.unblock.text']}"/>
          </h:panelGroup>
          <h:panelGroup layout="block" style="margin:10px"> </h:panelGroup>
          <eye:buttons>
            <eye:button>
              <h:commandLink styleClass="button-green"
                             value="#{bundle['client.dialog.button.confirm']}"
                             action="#{clientListController.unblockUser}"/>
            </eye:button>
            <eye:button>
              <h:commandLink styleClass="button-green"
                             value="#{bundle['client.dialog.button.cancel']}"
                             onclick="jsfc('clientUnblockDialog').hide(); return false;"/>
            </eye:button>
            <eye:space/>
          </eye:buttons>
        </eye:dialog>

        <eye:dialog id="clientPasswordResetDialog" title="#{bundle['client.dialog.passwordreset.title']}" width="450">
          <h:panelGroup layout="block">
            <h:outputText value="#{bundle['client.dialog.passwordreset.text']}"/>
          </h:panelGroup>
          <h:panelGroup layout="block" style="margin:10px"> </h:panelGroup>
          <eye:buttons>
            <eye:button>
              <h:commandLink styleClass="button-green"
                             value="#{bundle['client.dialog.passwordreset.confirm']}"
                             onclick="jsfc('clientPasswordResetDialog').hide(); return false;"/>
            </eye:button>
            <eye:button>
              <h:commandLink styleClass="button-green"
                             value="#{bundle['client.dialog.passwordreset.cancel']}"
                             onclick="jsfc('clientPasswordResetDialog').hide(); return false;"/>
            </eye:button>
            <eye:space/>
          </eye:buttons>
        </eye:dialog>


      </h:form>



    </ui:define>

  </ui:composition>

</f:view>
